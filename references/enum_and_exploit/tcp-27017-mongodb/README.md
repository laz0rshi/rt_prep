# MongoDB enumeration and exploitation
* [Initial enumeration](#initial-enumeration)
* [Connecting to a MongoDB database](#connecting-to-a-mongodb-database)
* [Enumerating a database](#enumerating-a-database)

## Initial enumeration
```bash
nmap -vv -p 27017,27018 -sT --script=+mongodb* <ip>
```

## Connecting to a MongoDB database
- Using mongo CLI:
```bash
mongo "mongodb://<username>@<ip>:27017/<database>" -p '<password>'
```

## Enumerating a database
- Get configuration:
```SQL
db.adminCommand({getParameter:"*"})
```
- Get current user and roles:
```SQL
db.runCommand({connectionStatus : 1})
```
- Get users:
```SQL
db.getUsers()
db.getUser("<username>")
```
- Get password hashes:
```bash
wget https://raw.githubusercontent.com/philsmd/mongodb2hashcat/main/mongodb2hashcat.js
mongo "mongodb://<username>@<ip>:27017/<database>" -p '<password>' --quiet mongodb2hashcat.js # Use 24100 and 24200 hashcat modes to crack them
```
- Show databases:
```SQL
show dbs
```
- Show current dabase:
```SQL
db
```
- Change database:
```SQL
use <database>
```
- Show collections:
```SQL
show collections
```
- Show data:
```SQL
db.<collection>.find()
db.<collection>.find().pretty()
```
